<h1>{{ poll.question }}</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<form action="{% url 'polls:vote' poll.id %}" method="post">
{% csrf_token %}
{% for choice in poll.choice_set.all %}
    <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" 
            {% if existing_vote %} disabled {% endif %}
            {% if existing_vote.choice == choice %} checked="checked"{% endif %}
    />
    <label for="choice{{ forloop.counter }}"/>{{ choice.choice_text }}  
        {% if choice.user %}
            <em> -- added by {{choice.user.username}}</em>
        {% endif %}
    </label><br />
{% endfor %}
{% if not existing_vote %}
  <input type="submit" value="Vote" />
{% endif %}
</form>

{% if authenticated_user %}
<form action="{% url 'polls:add' poll.id %}" method="post">
    {% csrf_token %}
    {{choice_form}}
    <input type="submit" name="submit" value="Submit" class="button">
</form>
{% endif %}